# 路由器刷机小记

这次更新的是路由器刷机的教程。
由于本人只刷过 极路由壹S 这一个路由器，因此下面所有的记录也都只是针对此款设备的，但是其实流程都是相通的，并没有很大的区别。
这里有一点需要指出，极路由壹S 本身有两种型号，一种是 HC5661，另一种是 HC5661A，可以通过底部标签或者包装盒的说明进行区分。这两种型号的 CPU 不同，因此下面需要用到的 Bootloader 和 固件 均不相同，下载时请注意，否则有变砖风险。


## 起因
一方面是看蒸汽动力论坛的推荐买了 [CC](https://www.cordcord.xyz/) 机场的流量，虽然后来看 [毒药笔记](https://github.com/DuyaoSS/SSR/issues/1) 的说法这个机场其实也很一般；另一方面是 Nintendo Switch 的更新实在是太慢了，想试试墙外的速度。
因此把已经吃灰许久的 极路由壹S 又翻了出来，但是发现官方后门（sid=163116535）只支持 SS，对 SSR 并没有支持，所以干脆刷个系统。一来已经买了华硕的 RT-ACRH17 作为日常使用，二来极路由这公司看上去也处于半倒闭状态，本来也指望不上了……


## 准备工作
这一步本质是开启 SSH 功能以便后续操作。

原理上可以和安装 SS 插件一样使用官方后门（sid=118284854），但是我没试过，不保证可行性。
也有的帖子说可以使用其他方式，例如 [B70免开发者权限开启SSH](https://www.right.com.cn/forum/thread-220214-1-1.html)，或者更暴力的可以通过修改硬件的方式，但是同样没试过，因此这里都不赘述。

目前看来最直接的方式是，获取 root 权限并安装“开发者模式”插件，官方教程在 [这里](http://www.hiwifi.com/service_faq?id=25&article_id=94)。
简单叙述一下：
1. 通过浏览器访问 192.168.199.1 并输入密码（默认是 admin），进入路由器后台；
2. 点击“智能插件”，进入“云插件”界面；
3. 点击“路由器信息”，在新页面中拉到底部，点击“+”展开“高级设置”中，点击“申请”；
4. 同意“服务条款”（主要就是失去保修），绑定手机号、微信，按提示操作即可；
5. 成功后，安装“开发者模式”插件即可。


## 刷入 Bootloader
Bootloader 是负责加载操作系统的程序，类似于电脑的 BIOS 或者手机的 Recovery。
这里我们将要使用的是恩山论坛的 [Breed](https://www.right.com.cn/forum/thread-161906-1-1.html)，号称“不死”。按照开发者的说法，“不死”指的是不会在升级固件时被其中自带的 Bootloader 覆盖，因此其本身“不死”。根据其他水友的说法，确实使用 Breed 后几乎不会有成砖的风险，大不了强刷成别的固件就好。

这里其实可用的方式有很多，比如采用 TFTP 进行上传，但是也比较麻烦。网上的教程通常采用 WinSCP，这里我们也采用这种方式。
1. 在 [Breed](https://www.right.com.cn/forum/thread-161906-1-1.html) 选择适合自己的程序。我这里选择 `breed-mt7628-hiwifi-hc5661a.bin`，将其下载到本地待用；
2. 先去 [官网下载页面](https://winscp.net/eng/download.php) 下载 WinSCP 工具，安装到本地电脑中，安装时选择双栏模式的话后面操作会方便一点；
3. 使用 WinSCP 链接到路由器。文件协议选择 `SCP`，主机名写 192.168.199.1，端口号写 1022，用户名写 root ，密码写自己极路由后台密码（默认是 admin），然后登陆首次登录会有提示，我们点“是”；
4. 在 /tmp 目录中放入前面保存的 Breed 程序。进入后默认是在 /root 目录下，需要先退到上一级才能找到 /tmp；
5. 再使用其他 SSH 客户端（例如[PuTTY](https://www.chiark.greenend.org.uk/~sgtatham/putty/)），连接到路由器中。地址仍然填 192.168.199.1，端口号写 1022；
6. 进入后要求登录，用户名写 root ，密码写自己极路由后台密码（默认是 admin）。如果看到字符画的 HiwiFi 则表示连接成功了；
7. 执行这条命令`mtd -r write /tmp/breed-mt7628-hiwifi-hc5661a.bin u-boot`，等待路由器重启即可。


## 刷入固件
固件同样可选的类型有很多，比如 openwrt 或者梅林，这里我们选择的是人称“毛子”的 Padavan。其也是根据华硕固件，由俄国大兄弟二次开发得到的。

1. 下载待用固件。我本人使用的是[RT-AC1200-GPIO-38-ji1A-128M](http://opt.cn2qq.com/padavan/)；
2. 首先我们要进入“Breed Web 恢复控制台”。这里有两种方式：
    - 使用 Web 模式。
        1. 电脑网络连接设置为自动获取 IP 地址；
        2. 打开 CMD，运行 ping 192.168.1.1 -t。注意从 r979 开始，这个 IP 地址是可以被修改的，所以在实际操作时，需要替换为修改后的 IP；
        3. 按住 复位键 或者 WPS键 再给路由通电，如果看到路由器的部分或全部LED连闪4次，或 ping 通即表明进入 Web 刷机模式。
    - 使用工具免复位进入刷机模式
        1. 先安装 [Npcap](https://github.com/nmap/npcap/releases) 以支持下面的工具；
        2. 再下载 |  [BreedEnter.zip](https://breed.hackpascal.net/BreedEnter.zip) 工具；
        3. 运行 BreedEnter 工具，将路由器与电脑用网线连接，将路由器断电再通电；
        4. 看到弹窗提示，则证明已成功，通过路由器访问 192.168.1.1 即可。
3. 备份当前固件。这个看心情自己选；
4. 升级固件，点击上传、更新。这里需要指出，为了避免更新系统时将 Breed 覆盖，所以后续升级也建议在此处升级；
5. 访问 192.168.123.1，进入路由器后台。默认用户名和密码均为 admin。


## 系统配置
这一部分就很简单了，从机场里导入 SSR 设置即可。注意别忘记开启 SS 插件的开关，要不然是不会生效的。最后在节点列表里选择想要使用的节点即可。